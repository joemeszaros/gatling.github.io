




<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Simulation structure &mdash; Gatling documentation</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Maven+Pro:400,500,700" type="text/css" />
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Inconsolata:400,700" type="text/css" />
    <link rel="stylesheet" href="/vendor/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="/vendor/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="/assets/css/style.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.0.0-SNAPSHOT',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="/vendor/javascripts/modernizr.min.js"></script>
    <script type="text/javascript" src="/vendor/javascripts/bootstrap.min.js"></script>
    <link rel="top" title="Gatling documentation" href="../index.html" />
    <link rel="up" title="General" href="index.html" />
    <link rel="next" title="Simulation setup" href="simulation_setup.html" />
    <link rel="prev" title="Configuration" href="configuration.html" />
<!--[if IE]>
<script src="/vendor/javascripts/html5shiv.min.js"></script>
<![endif]-->

<!--[if IE 6]>
<script src="/vendor/javascripts/PIE_IE678.min.js"></script>
<![endif]-->
<!--[if IE 7]>
<script src="/vendor/javascripts/PIE_IE678.min.js"></script>
<![endif]-->
<!--[if IE 9]>
<script src="/vendor/javascripts/PIE_IE9.min.js"></script>
<![endif]-->

<script type="text/javascript">
  // @formatter:off
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-53375088-1', 'gatling.io');
  ga('send', 'pageview');
  // @formatter:on
</script>

<script type='text/javascript'>
  $(document).ready(function () {
    $('#affix').affix({
      offset: {
        top: 48
      }
    });

    $('body').scrollspy({
      target: '#affix'
    })
  });
</script>

  </head>
  <body role="document">
<header id="header" class="navbar navbar-static-top" role="banner">
  <div class="container">
    <div class="navbar" role="navigation">
      <form action="../search.html" class="col-xs-12 col-sm-6 col-md-4" method="get" role="form">
        <div class="form-group">
          <div class="input-group">
            <input type="text" class="form-control" name="q" placeholder="Search through the documentation"/>

            <div class="input-group-addon">
              <button type="submit"><i class="glyphicon glyphicon-search"></i></button>
            </div>
            <div class="input-group-addon">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
            </div>
          </div>
        </div>
        <input type="hidden" name="check_keywords" value="yes"/>
        <input type="hidden" name="area" value="default"/>
      </form>

      <nav id="navbar-collapse" class="collapse navbar-collapse">
        <ul class="nav navbar-nav navbar-right">
          <li><a href="/#/">HOME</a></li>
          <li><a href="/#/download">DOWNLOAD</a></li>
          <li class="active"><a href="/#/docs">DOCUMENTATION</a></li>
          <li><a href="/#/services">PROFESSIONAL SERVICES</a></li>
          <li><a class="icon icon-github" href="https://github.com/gatling/gatling"></a></li>
          <li><a class="icon icon-twitter" href="https://twitter.com/GatlingTool"></a></li>
          <li><a class="icon icon-googlegroup" href="https://groups.google.com/forum/#!forum/gatling"></a></li>
        </ul>
      </nav>
      <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
  </div>
</header>

<section id="doc">
  <div class="container">
    <section class="row">
      <div class="col-md-9">
          <ul class="breadcrumb">
            <li><a href="../index.html">Gatling documentation</a></li>
            <li><a href="index.html"
              accesskey="U">
              General
              </a>
            </li>
            <li><a href="">
              Simulation structure
            </a></li>
          </ul>
          
  <div class="section" id="simulation-structure">
<span id="id1"></span><h1>Simulation structure<a class="headerlink" href="#simulation-structure" title="Permalink to this headline">¶</a></h1>
<p>A <code class="docutils literal"><span class="pre">Simulation</span></code> is a real Scala class containing 4 different parts:</p>
<ul class="simple">
<li>The HTTP protocol configuration</li>
<li>The headers definition</li>
<li>The scenario definition</li>
<li>The simulation definition</li>
</ul>
<p>To illustrate this point we will take one of our sample simulations: <a class="reference external" href="https://github.com/gatling/gatling/blob/master/gatling-bundle/src/universal/user-files/simulations/computerdatabase/BasicSimulation.scala">computerdatabase.BasicSimulation</a></p>
<div class="section" id="http-protocol-configuration">
<h2>HTTP protocol configuration<a class="headerlink" href="#http-protocol-configuration" title="Permalink to this headline">¶</a></h2>
<p>The first element is the configuration of the HTTP protocol.
In this example, this configuration is very basic and just defines:</p>
<ul class="simple">
<li>the <code class="docutils literal"><span class="pre">baseURL</span></code>, which will be prepended to all the relative paths in the scenario definition.
Here, the base URL is <a class="reference external" href="http://computer-database.gatling.io">http://computer-database.gatling.io</a></li>
<li>common headers, which will be added on each request.</li>
</ul>
<p>The HTTP Configuration is stored as a Scala value so that we can set it later in the simulation definition.</p>
</div>
<div class="section" id="headers-definition">
<h2>Headers definition<a class="headerlink" href="#headers-definition" title="Permalink to this headline">¶</a></h2>
<p>As you&#8217;ll see later, when we define the scenario for Gatling, we can provide the headers used for each request sent to the server.
As the file was generated by the recorder, all headers are declared in the beginning of the file and used in the scenario definition.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Adding common headers can seem useless, but don&#8217;t forget that they add load on your server and have a real impact on the server behavior (like <code class="docutils literal"><span class="pre">Accept-Encoding</span></code> or <code class="docutils literal"><span class="pre">If-Last-Modified</span></code>).</p>
</div>
<p>Headers are declared as Scala Maps:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">val</span> <span class="n">headers_10</span> <span class="k">=</span> <span class="nc">Map</span><span class="o">(</span><span class="s">&quot;Content-Type&quot;</span> <span class="o">-&gt;</span> <span class="s">&quot;&quot;&quot;application/x-www-form-urlencoded&quot;&quot;&quot;</span><span class="o">)</span>
</pre></div>
</div>
</div>
<div class="section" id="scenario-definition">
<h2>Scenario definition<a class="headerlink" href="#scenario-definition" title="Permalink to this headline">¶</a></h2>
<p>After the headers definition comes the scenario definition.
This definition has a name because you can define several scenarios in the same simulation.
A scenario is usually stored in a Scala value:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">val</span> <span class="n">scn</span> <span class="k">=</span> <span class="n">scenario</span><span class="o">(</span><span class="s">&quot;ScenarioName&quot;</span><span class="o">)</span> <span class="c1">// etc...</span>
</pre></div>
</div>
<p>The scenario structure basically consists of chaining two methods: <code class="docutils literal"><span class="pre">exec</span></code> and <code class="docutils literal"><span class="pre">pause</span></code>.
The first one is used to describe an action, usually a request sent to the tested application; the second one is used to simulate the think time of the user between consecutive requests.</p>
<p>HTTP requests are defined as follows in a scenario:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="c1">// Here&#39;s an example of a POST request</span>
<span class="n">http</span><span class="o">(</span><span class="s">&quot;request_10&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">post</span><span class="o">(</span><span class="s">&quot;/computers&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">headers</span><span class="o">(</span><span class="n">headers_10</span><span class="o">)</span>
  <span class="o">.</span><span class="n">formParam</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">,</span> <span class="s">&quot;Beautiful Computer&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">formParam</span><span class="o">(</span><span class="s">&quot;introduced&quot;</span><span class="o">,</span> <span class="s">&quot;2012-05-30&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">formParam</span><span class="o">(</span><span class="s">&quot;discontinued&quot;</span><span class="o">,</span> <span class="s">&quot;&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">formParam</span><span class="o">(</span><span class="s">&quot;company&quot;</span><span class="o">,</span> <span class="s">&quot;37&quot;</span><span class="o">)</span>
</pre></div>
</div>
<p>The above example produces a POST HTTP request that creates a new computer model:</p>
<div class="highlight-scala"><div class="highlight"><pre>HTTP request:
POST http://computer-database.gatling.io/computers
headers=
  Accept: [text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8]
  Content-Type: [application/x-www-form-urlencoded]
  DNT: [1]
  Accept-Language: [en-US,en;q=0.5]
  Accept-Encoding: [gzip, deflate]
  User-Agent: [Mozilla/5.0 (Macintosh; Intel Mac OS X 10.8; rv:16.0) Gecko/20100101 Firefox/16.0]
  Referer: [http://computer-database.gatling.io/computers/new]
params=
  company: [37]
  discontinued: []
  name: [Beautiful Computer]
  introduced: [2012-05-30]
</pre></div>
</div>
</div>
<div class="section" id="simulation-definitions">
<h2>Simulation definitions<a class="headerlink" href="#simulation-definitions" title="Permalink to this headline">¶</a></h2>
<p>The last part of the file contains the simulation definition, this is where you define the load you want to inject to your server, e.g.:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="n">setUp</span><span class="o">(</span>
  <span class="n">scn</span><span class="o">.</span><span class="n">inject</span><span class="o">(</span><span class="n">atOnceUsers</span><span class="o">(</span><span class="mi">1</span><span class="o">))</span> <span class="c1">// (1)</span>
    <span class="o">.</span><span class="n">protocols</span><span class="o">(</span><span class="n">httpConf</span><span class="o">)</span> <span class="c1">// (2)</span>
<span class="o">)</span>
</pre></div>
</div>
<p>which correspond to:</p>
<ol class="arabic simple">
<li>We inject one single user into the <code class="docutils literal"><span class="pre">scn</span></code> scenario</li>
<li>We configure <code class="docutils literal"><span class="pre">httpConf</span></code> on the <code class="docutils literal"><span class="pre">setUp</span></code> so that we pass the base URL and the common headers.</li>
</ol>
</div>
<div class="section" id="hooks">
<span id="simulation-hooks"></span><h2>Hooks<a class="headerlink" href="#hooks" title="Permalink to this headline">¶</a></h2>
<p>Gatling provides two hooks:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">before</span></code> for executing some code before the simulation actually runs</li>
<li><code class="docutils literal"><span class="pre">after</span></code> for executing some code after the simulation actually runs</li>
</ul>
<div class="highlight-scala"><div class="highlight"><pre><span class="n">before</span> <span class="o">{</span>
  <span class="n">println</span><span class="o">(</span><span class="s">&quot;Simulation is about to start!&quot;</span><span class="o">)</span>
<span class="o">}</span>

<span class="n">after</span> <span class="o">{</span>
  <span class="n">println</span><span class="o">(</span><span class="s">&quot;Simulation is finished!&quot;</span><span class="o">)</span>
<span class="o">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You won&#8217;t be able to use Gatling DSL in there, as it&#8217;s only intended for load test. You can only use your custom code.</p>
</div>
</div>
</div>


        </div>
        <div class="col-md-3">
          <aside id="affix" class="visible-md visible-lg">
            <ul class="nav">
<li><a class="reference internal" href="#">Simulation structure</a><ul class="nav">
<li><a class="reference internal" href="#http-protocol-configuration">HTTP protocol configuration</a></li>
<li><a class="reference internal" href="#headers-definition">Headers definition</a></li>
<li><a class="reference internal" href="#scenario-definition">Scenario definition</a></li>
<li><a class="reference internal" href="#simulation-definitions">Simulation definitions</a></li>
<li><a class="reference internal" href="#hooks">Hooks</a></li>
</ul>
</li>
</ul>

            
<hr>
<ul class="nav">
  <li>
    <a href="https://github.com/gatling/gatling/edit/master/src/sphinx/general/simulation_structure.rst">Edit this page on Github</a>
  </li>
  <h5>Previous topic</h5>
  <li>
    <a href="configuration.html" title="Previous Chapter: Configuration">
      Configuration
    </a>
  </li>
  <h5>Next topic</h5>
  <li>
    <a href="simulation_setup.html" title="Next Chapter: Simulation setup">
      Simulation setup
    </a>
  </li>
</ul>
          </aside>
        </div>
      </div>
    </section>
  </div>
</section>

<footer id="footer" style="position:static">
  <section class="row-fluid">
    <div class="content-wrapper text-center">&copy;2015 Gatling Corp 2000-2015</div>
  </section>
</footer>






  </body>
</html>